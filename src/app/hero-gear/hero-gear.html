<div class="container">
  <h1>Hero Gear Optimizer</h1>

  <div class="resource-inputs">
    <div class="resource-item">
      <label for="exp-input">Available EXP:</label>
      <input id="exp-input" type="number" [value]="exp()" (input)="updateExp($event)">
    </div>
    <div class="resource-item">
      <label for="hammers-input">Number of Hammers:</label>
      <input id="hammers-input" type="number" [value]="hammers()" (input)="updateHammers($event)">
    </div>
  </div>

  @for (hero of heroes(); track hero.name) {
    <div class="hero-section">
      <h2>{{ hero.name }}</h2>
      <div class="gear-grid">
        @for (gearType of objectKeys(hero.gear); track gearType) {
          <div class="gear-item">
            <label class="gear-label">{{ gearType }}</label>
            <div class="gear-inputs">
              <label>Mastery:</label>
              <input type="number" [value]="hero.gear[gearType].mastery" (input)="updateMastery(hero.name, gearType, $event)">
              <label>Enhancement:</label>
              <input type="number" [value]="hero.gear[gearType].enhancement" (input)="updateEnhancement(hero.name, gearType, $event)">
            </div>
          </div>
        }
      </div>
    </div>
  }

  <div class="advanced-section">
    <button class="advanced-toggle" (click)="toggleAdvanced()">
      Advanced Settings
      <span class="toggle-icon">{{ isAdvancedCollapsed() ? '&#9660;' : '&#9650;' }}</span>
    </button>
    @if (!isAdvancedCollapsed()) {
      <div class="advanced-content">
        @for (hero of heroes(); track hero.name) {
          <div class="hero-weights">
            <h4>{{ hero.name }} Weights</h4>
            <div class="weight-inputs">
              <label>Lethality:</label>
              <input type="number" [value]="hero.weights.lethality" (input)="updateWeight(hero.name, 'lethality', $event)">
              <label>Health:</label>
              <input type="number" [value]="hero.weights.health" (input)="updateWeight(hero.name, 'health', $event)">
            </div>
          </div>
        }
      </div>
    }
  </div>

  <button (click)="optimize()">Optimize</button>

  @if (optimizationResult(); as results) {
    <div class="results-section">
      <h3>Optimization Results</h3>
      @for (result of results; track result.heroName) {
        <div class="hero-results">
          <h4>{{ result.heroName }}</h4>
          <table class="results-table">
            <thead>
              <tr>
                <th>Gear</th>
                <th>Current Mastery</th>
                <th>Recommended Mastery</th>
                <th>Current Enhancement</th>
                <th>Recommended Enhancement</th>
              </tr>
            </thead>
            <tbody>
              @for (gear of result.gear; track gear.type) {
                <tr>
                  <td>{{ gear.type }}</td>
                  <td>{{ gear.currentMastery }}</td>
                  <td>{{ gear.recommendedMastery }}</td>
                  <td>{{ gear.currentEnhancement }}</td>
                  <td>{{ gear.recommendedEnhancement }}</td>
                </tr>
              }
            </tbody>
          </table>

          <h5 class="stats-title">Stat Comparison</h5>
          <table class="stats-table">
            <thead>
              <tr>
                <th>Stat</th>
                <th>Before</th>
                <th>After</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Lethality</td>
                <td>{{ (result.beforeStats.lethality * 100) | number:'1.2-2' }}%</td>
                <td>{{ (result.afterStats.lethality * 100) | number:'1.2-2' }}%</td>
              </tr>
              <tr>
                <td>Health</td>
                <td>{{ (result.beforeStats.health * 100) | number:'1.2-2' }}%</td>
                <td>{{ (result.afterStats.health * 100) | number:'1.2-2' }}%</td>
              </tr>
            </tbody>
          </table>
        </div>
      }
    </div>
  }
</div>
