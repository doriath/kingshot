<div class="detail-header">
    <button class="back-button" (click)="back.emit()">Back to List</button>
    <h2>Swordland Event Details</h2>
    <div class="event-info">
        <p><strong>Alliance:</strong> {{ event().allianceName }}</p>
        <p><strong>Server:</strong> {{ event().server }}</p>
        <p><strong>Date:</strong> {{ event().date?.seconds * 1000 | date:'medium' }}</p>
        <p><strong>Legion:</strong> {{ event().legion }}</p>
    </div>
</div>

<div class="groups-container">
    @for (group of groupedParticipants(); track group.name) {
    <div class="building-section">
        <h3>{{ group.name }}</h3>
        <ul>
            @for (p of group.participants; track p.characterId) {
            <li [class.attacker]="p.role === 'attacker'" [class.defender]="p.role === 'defender'"
                [class.expanded]="expandedSet().has(p.characterId)" (click)="toggleParticipant(p.characterId)">
                <div class="participant-header">
                    <div class="participant-info">
                        @if (p.role === 'attacker') {
                        <span class="icon attacker-icon" title="Attacker">‚öîÔ∏è</span>
                        } @else if (p.role === 'defender') {
                        <span class="icon defender-icon" title="Defender">üõ°Ô∏è</span>
                        } @else {
                        <span class="icon unassigned-icon">?</span>
                        }

                        <span class="name">{{ p.characterName }}</span>
                        <span class="score">{{ p.squadScore | number }}</span>
                    </div>
                    <span class="chevron">‚ñº</span>
                </div>
                @if (expandedSet().has(p.characterId)) {
                <div class="instructions" (click)="$event.stopPropagation()">
                    <strong>Instructions:</strong> {{ getInstructions(p) }}
                </div>
                }
            </li>
            }
        </ul>
    </div>
    } @empty {
    <div class="empty-state">No participants assigned yet.</div>
    }
</div>